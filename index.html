<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>2D City Survivor</title>
    <style>
        body { margin: 0; overflow: hidden; background: #2c3e50; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; }
        #ui {
            position: absolute; top: 10px; left: 10px; color: white;
            background: rgba(0,0,0,0.8); padding: 15px; border-radius: 5px; pointer-events: none;
        }
        #hotbar {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 5px; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 10px;
        }
        .slot {
            width: 50px; height: 50px; border: 2px solid #555; display: flex;
            justify-content: center; align-items: center; color: white; position: relative;
        }
        .slot.active { border-color: #f1c40f; background: rgba(241, 196, 15, 0.2); }
        .key-hint { position: absolute; top: 2px; left: 2px; font-size: 10px; color: #aaa; }
        #hp-container {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 15px; background: #444; border: 2px solid white;
        }
        #hp-bar { width: 100%; height: 100%; background: #2ecc71; }
    </style>
</head>
<body>

    <div id="ui">
        WASD: Gå | E: Bil | T: Plukk opp | I: Skyte<br>
        Hold talltast (f.eks. 2) i 2 sek for å bruke Medkit
    </div>

    <div id="hp-container"><div id="hp-bar"></div></div>

    <div id="hotbar">
        <div class="slot" id="slot1"><span class="key-hint">1</span></div>
        <div class="slot" id="slot2"><span class="key-hint">2</span></div>
        <div class="slot" id="slot3"><span class="key-hint">3</span></div>
        <div class="slot" id="slot4"><span class="key-hint">4</span></div>
        <div class="slot" id="slot5"><span class="key-hint">5</span></div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const worldSize = 4000;
const keys = {};
let activeSlot = 1;
let useTimer = 0;

// Spill-objekter
const player = { x: 500, y: 500, hp: 100, maxHp: 100, speed: 4, inVehicle: false, inventory: {} };
const car = { x: 800, y: 800, w: 60, h: 100, angle: 0, speed: 0, friction: 0.96 };
const monsters = Array.from({length: 15}, () => ({ x: Math.random()*worldSize, y: Math.random()*worldSize, hp: 1 }));
const items = [
    { x: 600, y: 550, type: 'Medkit', color: '#e74c3c', label: 'H' },
    { x: 1000, y: 900, type: 'Blaster', color: '#f1c40f', label: 'B' }
];
const projectiles = [];
const particles = [];
const houses = Array.from({length: 10}, () => ({ x: Math.random()*(worldSize-200), y: Math.random()*(worldSize-200), w: 150, h: 150 }));

window.addEventListener("keydown", e => {
    keys[e.key.toLowerCase()] = true;
    if (e.key >= '1' && e.key <= '9') {
        activeSlot = parseInt(e.key);
        updateUI();
    }
});
window.addEventListener("keyup", e => {
    keys[e.key.toLowerCase()] = false;
    if (e.key >= '1' && e.key <= '9') useTimer = 0;
});

function updateUI() {
    document.querySelectorAll('.slot').forEach((s, i) => {
        s.classList.toggle('active', i + 1 === activeSlot);
        const itemName = player.inventory[i + 1];
        s.innerText = itemName ? itemName[0] : ""; // Viser første bokstav
        const hint = document.createElement('span');
        hint.className = 'key-hint'; hint.innerText = i + 1;
        s.appendChild(hint);
    });
}

function update() {
    // Bevegelse
    if (!player.inVehicle) {
        if (keys['w']) player.y -= player.speed;
        if (keys['s']) player.y += player.speed;
        if (keys['a']) player.x -= player.speed;
        if (keys['d']) player.x += player.speed;
    } else {
        if (keys['w']) car.speed += 0.2;
        if (keys['s']) car.speed -= 0.1;
        car.speed *= car.friction;
        if (Math.abs(car.speed) > 0.1) {
            if (keys['a']) car.angle -= 0.05;
            if (keys['d']) car.angle += 0.05;
        }
        car.x += Math.cos(car.angle) * car.speed;
        car.y += Math.sin(car.angle) * car.speed;
        player.x = car.x; player.y = car.y;
    }

    // Skyting med 'I'
    if (keys['i'] && player.inventory[activeSlot] === 'Blaster') {
        projectiles.push({ x: player.x, y: player.y, vx: Math.cos(car.angle) * 10, vy: Math.sin(car.angle) * 10 });
        keys['i'] = false; // Hindrer automatisk ild
    }

    // Bruk Medkit (Hold inne)
    if (player.inventory[activeSlot] === 'Medkit' && keys[activeSlot.toString()]) {
        useTimer++;
        if (useTimer > 120) { // ca 2 sekunder i 60fps
            player.hp = player.maxHp;
            delete player.inventory[activeSlot];
            useTimer = 0;
            updateUI();
        }
    }

    // Plukk opp
    if (keys['t']) {
        items.forEach((it, i) => {
            if (Math.hypot(player.x - it.x, player.y - it.y) < 50) {
                for(let s=1; s<=5; s++) {
                    if(!player.inventory[s]) { player.inventory[s] = it.type; items.splice(i, 1); break; }
                }
                updateUI();
            }
        });
    }

    // HP Bar
    document.getElementById("hp-bar").style.width = player.hp + "%";

    // Monstre følger etter
    monsters.forEach(m => {
        let dist = Math.hypot(player.x - m.x, player.y - m.y);
        if (dist < 300) {
            m.x += (player.x - m.x)/dist * 2;
            m.y += (player.y - m.y)/dist * 2;
        }
        if (dist < 25) player.hp -= 0.2;
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-player.x + canvas.width/2, -player.y + canvas.height/2);

    // Bakgrunn og veier
    ctx.fillStyle = "#3e8e41"; ctx.fillRect(0,0, worldSize, worldSize);
    ctx.fillStyle = "#333";
    for(let i=0; i<worldSize; i+=1000) {
        ctx.fillRect(i, 0, 100, worldSize);
        ctx.fillRect(0, i, worldSize, 100);
    }

    // Hus
    houses.forEach(h => {
        ctx.fillStyle = "#5d4037"; ctx.fillRect(h.x, h.y, h.w, h.h);
        ctx.strokeStyle = "white"; ctx.strokeRect(h.x, h.y, h.w, h.h);
    });

    // Items
    items.forEach(it => {
        ctx.fillStyle = it.color; ctx.fillRect(it.x, it.y, 20, 20);
    });

    // Bil
    ctx.save(); ctx.translate(car.x, car.y); ctx.rotate(car.angle);
    ctx.fillStyle = "blue"; ctx.fillRect(-30, -50, 60, 100); ctx.restore();

    // Fiender
    monsters.forEach(m => {
        ctx.fillStyle = "red"; ctx.beginPath(); ctx.arc(m.x, m.y, 15, 0, Math.PI*2); ctx.fill();
    });

    // Spiller
    if (!player.inVehicle) {
        ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(player.x, player.y, 15, 0, Math.PI*2); ctx.fill();
    }

    ctx.restore();
    update();
    requestAnimationFrame(draw);
}
draw();
updateUI();
</script>
</body>
</html>
