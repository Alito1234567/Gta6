<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D City Adventure</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; }
        canvas { display: block; }
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            pointer-events: none;
        }
        #inventory {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #f1c40f;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border: 2px solid #f1c40f;
            min-width: 150px;
        }
    </style>
</head>
<body>

    <div id="ui">
        <strong>KONTROLLER:</strong><br>
        Bevegelse: WASD | Bil: E | Plukk opp: T
    </div>

    <div id="inventory">
        <strong>INVENTAR:</strong>
        <ul id="inv-list"><li>Tomt</li></ul>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const invList = document.getElementById("inv-list");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const keys = {};
const worldSize = 3000;
const camera = { x: 0, y: 0 };

// Spiller
const player = {
    x: 500, y: 500,
    size: 20,
    speed: 4,
    inVehicle: false,
    inventory: []
};

// Bil
const car = {
    x: 700, y: 700,
    w: 50, h: 90,
    angle: 0,
    speed: 0,
    friction: 0.97
};

// Gjenstander på bakken
const worldItems = [
    { x: 600, y: 550, name: "Verktøy", color: "silver" },
    { x: 1200, y: 800, name: "Pakke", color: "brown" }
];

// NPCer (Fiender/Borgere)
const npcs = [
    { x: 1000, y: 1000, size: 20, speed: 1.5, color: "#e67e22" },
    { x: 400, y: 1200, size: 20, speed: 1.5, color: "#e67e22" }
];

window.addEventListener("keydown", (e) => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", (e) => keys[e.key.toLowerCase()] = false);

// Interaksjons-taster
window.addEventListener("keydown", (e) => {
    const key = e.key.toLowerCase();
    
    // Gå inn/ut av bil (E)
    if (key === 'e') {
        const dist = Math.hypot(player.x - car.x, player.y - car.y);
        if (!player.inVehicle && dist < 70) {
            player.inVehicle = true;
        } else if (player.inVehicle) {
            player.inVehicle = false;
            player.x += 60; 
        }
    }

    // Plukk opp gjenstand (T)
    if (key === 't' && !player.inVehicle) {
        worldItems.forEach((item, index) => {
            const dist = Math.hypot(player.x - item.x, player.y - item.y);
            if (dist < 40) {
                player.inventory.push(item.name);
                worldItems.splice(index, 1);
                updateInventoryUI();
            }
        });
    }
});

function updateInventoryUI() {
    invList.innerHTML = player.inventory.map(i => `<li>${i}</li>`).join("");
}

function update() {
    if (!player.inVehicle) {
        if (keys['w']) player.y -= player.speed;
        if (keys['s']) player.y += player.speed;
        if (keys['a']) player.x -= player.speed;
        if (keys['d']) player.x += player.speed;
    } else {
        if (keys['w']) car.speed += 0.2;
        if (keys['s']) car.speed -= 0.1;
        if (Math.abs(car.speed) > 0.1) {
            if (keys['a']) car.angle -= 0.05;
            if (keys['d']) car.angle += 0.05;
        }
        car.speed *= car.friction;
        car.x += Math.cos(car.angle) * car.speed;
        car.y += Math.sin(car.angle) * car.speed;
        player.x = car.x;
        player.y = car.y;
    }

    // NPC Logikk - følg etter spilleren
    npcs.forEach(npc => {
        const dx = player.x - npc.x;
        const dy = player.y - npc.y;
        const dist = Math.hypot(dx, dy);
        
        if (dist < 400 && dist > 10) { // Følger etter hvis spilleren er i nærheten
            npc.x += (dx / dist) * npc.speed;
            npc.y += (dy / dist) * npc.speed;
        }
    });

    camera.x = player.x - canvas.width / 2;
    camera.y = player.y - canvas.height / 2;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-camera.x, -camera.y);

    // Bakgrunn/Verden
    ctx.fillStyle = "#2c3e50";
    ctx.fillRect(0, 0, worldSize, worldSize);

    // Tegn Items
    worldItems.forEach(item => {
        ctx.fillStyle = item.color;
        ctx.fillRect(item.x, item.y, 15, 15);
    });

    // Tegn NPCer
    npcs.forEach(npc => {
        ctx.fillStyle = npc.color;
        ctx.beginPath();
        ctx.arc(npc.x, npc.y, npc.size, 0, Math.PI*2);
        ctx.fill();
    });

    // Tegn Bil
    ctx.save();
    ctx.translate(car.x, car.y);
    ctx.rotate(car.angle);
    ctx.fillStyle = "#c0392b";
    ctx.fillRect(-car.w/2, -car.h/2, car.w, car.h);
    ctx.restore();

    // Tegn Spiller
    if (!player.inVehicle) {
        ctx.fillStyle = "#3498db";
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
        ctx.fill();
    }

    ctx.restore();
    requestAnimationFrame(draw);
}

setInterval(update, 1000/60);
draw();
</script>
</body>
</html>
